#!/usr/bin/env python
# -*- coding:utf-8 -*-
"""
@author: danerlt
@file: pre_commit
@time: 2022-10-25
@contact: danerlt001.gmail.com
@des: ç”ŸæˆREADME  è¿™ä¸ªæ–‡ä»¶è¦æ”¾åœ¨.git/hooksç›®å½•ä¸‹
"""

import os
import sys
import traceback

# pre_commit
current_path = os.path.dirname(os.path.abspath(__file__))
print(f"current_path: {current_path}")
hooks_path = os.path.dirname(current_path)  # hooksç›®å½•
git_path = os.path.dirname(hooks_path)  # .gitç›®å½•
root_path = os.path.dirname(git_path)  # é¡¹ç›®æ ¹ç›®å½•
readme_path = os.path.join(root_path, "README.md")
python3_path = os.path.join(root_path, "Python3")


def get_tags_by_python_file(file_path):
    """ä»æ–‡ä»¶ä¸­è·å–æ ‡ç­¾

    :param file_path: æ–‡ä»¶è·¯å¾„
    :return: æ ‡ç­¾ å¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”
    """
    try:
        not_tags = ["#", "Related", "Topics", "ğŸ‘", "ğŸ‘"]

        tags = []
        with open(file_path, "r", encoding="utf-8") as f:
            lines = f.readlines()
            for line in lines:
                line = line.strip()
                if line and "Related Topics" in line:
                    # ç¤ºä¾‹: #  Related Topics æ ˆ æ ‘ æ·±åº¦ä¼˜å…ˆæœç´¢ äºŒå‰æ ‘ ğŸ‘ 925 ğŸ‘ 0
                    arr = line.split(" ")
                    for item in arr:
                        item = item.strip()
                        if item and item not in not_tags:
                            try:
                                int_tem = int(item)
                                # è¯´æ˜æ˜¯æ•°å­—
                            except Exception:
                                # è¯´æ˜ä¸æ˜¯æ•°å­— æ˜¯æ ‡ç­¾
                                tags.append(item)

        if tags:
            return ",".join(tags)
        else:
            return ""
    except Exception:
        return ""


def gen_content():
    """ç”Ÿæˆè¡¨æ ¼"""
    table_head = "| é¢˜ç›® | ç®—æ³•å®ç°  |  æ ‡ç­¾| \n|------|-------------|------|"

    tables = {}
    for py_file in os.listdir(python3_path):
        py_file_path = os.path.join(python3_path, py_file)
        if os.path.isfile(py_file_path):
            # py_file s.g. 100.ç›¸åŒçš„æ ‘.py
            try:
                topic_num, py_file_name, _ = py_file.split(".")
            except Exception as e:
                print(f"gen_content split å¤±è´¥, py_file: {py_file}")
                raise
            tags = get_tags_by_python_file(py_file_path)
            row = f"| {topic_num}.{py_file_name} | [{py_file}](./Python3/{py_file}) | {tags}"
            topic_num = int(topic_num)  # å°†é¢˜ç›®å·è½¬æˆintç±»å‹
            tables[topic_num] = row

    tables_list = []
    for key in sorted(tables.keys()):
        row = tables[key]
        tables_list.append(row)
    tables_str = "\n".join(tables_list)

    content = f"{table_head}\n{tables_str}"
    print("ç”Ÿæˆå†…å®¹æˆåŠŸ")
    return content


def gen_title():
    """
    ç”Ÿæˆæ ‡é¢˜
    :return:
    """
    title = "# leetcode é¢˜è§£\n\n## Python3å®ç°"
    print("ç”Ÿæˆæ ‡é¢˜æˆåŠŸ")
    return title


def write_data(data):
    with open(readme_path, "w", encoding="utf-8") as f:
        f.write(data)
    print("å†™å…¥æ•°æ®æˆåŠŸ")


def gen_readme():
    title = gen_title()
    content = gen_content()
    data = title + "\n\n" + content
    write_data(data)
    print("ç”ŸæˆREADMEæ–‡ä»¶æˆåŠŸ")


def main():
    try:
        gen_readme()
        os.system("git add README.md")
    except Exception as e:
        t, v, tb = sys.exc_info()
        traceback.print_tb(tb)


def t_tags():
    tags = get_tags_by_python_file(os.path.join(python3_path, "392.åˆ¤æ–­å­åºåˆ—.py"))
    print(tags)


if __name__ == '__main__':
    main()
